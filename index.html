<html>

<head>
    <title>
        Cronopitch
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js" type="text/javascript"></script>

    <script>
        // Set the date we're counting down to
        //var countDownDate = new Date("Jun 3, 2017 15:37:25").getTime();
        var timer = null;
        var countDownDate = null;
        $(function() {
            $("#setTime").click(function() {
                if (timer != null) {
                    clearInterval(timer);
                }
                console.log($("#time").find(":selected").val());
                var minutesLeft = $("#time").find(":selected").val();
                countDownDate = new Date().getTime() + (60000 * minutesLeft);
                setTimeCookie(countDownDate);
                setTimer(countDownDate);
            });
            $("#resetTime").click(function() {
                if (timer != null) {
                    clearInterval(timer);
                }
                countDownDate = new Date().getTime();
                setTimeCookie(countDownDate);
                $("#setTime").show();
                $("#time").show();
                $("#resetTime").hide();
                $("#demo").css("font-size", "100");
                $("#demo").text("Set your timer");
            });
            var countDownDateCookie = readCookie('cronopitch');
            if (countDownDateCookie != null) {
                var now = new Date();
                console.log(countDownDateCookie + " - " + now.getTime());
                if (countDownDateCookie > now.getTime()) {
                    setTimer(countDownDateCookie);
                }
            }
        });

        function setTimer(countDownDate) {
            $("#demo").text("");
            $("#demo").css("font-size", "250");
            $("#labelTime").hide();
            $("#time").hide();
            $("#resetTime").show();
            // Update the count down every 1 second
            timer = setInterval(function() {

                // Get todays date and time
                var now = new Date().getTime();

                // Find the distance between now an the count down date
                var distance = countDownDate - now;

                // Time calculations for days, hours, minutes and seconds
                var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                if (seconds < 10) {
                    seconds = "0" + seconds;
                }

                // Display the result in the element with id="demo"
                // document.getElementById("demo").innerHTML = days + "d " + hours + "h " +
                //     minutes + "m " + seconds + "s ";
                if (hours > 0) {
                    $("#demo").text(hours + ":" + minutes + ":" + seconds);
                } else if (minutes > 0) {
                    $("#demo").text(minutes + ":" + seconds);
                } else {
                    $("#demo").text(seconds);
                }

                // If the count down is finished, write some text 
                if (distance < 0) {
                    clearInterval(timer);
                    document.getElementById("demo").innerHTML = "EXPIRED";
                }
            }, 500);
        }
    </script>
    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-100391160-1', 'auto');
        ga('send', 'pageview');
    </script>
    <script>
        function createCookie(name, value, days) {
            var expires = "";
            if (days) {
                var date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + value + expires + "; path=/";
        }

        function readCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            console.log(ca);
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        function eraseCookie(name) {
            createCookie(name, "", -1);
        }

        function setTimeCookie(minutes) {
            createCookie('cronopitch', minutes, 7);
        }
    </script>
</head>

<body>
    <p id="demo" style="font-size:100" align="center">Set your timer</p>
    <p id="demo2"></p>

    <div class="form-group" align="center">
        <select id="time">
            <option value="10">10 minutes</option>
            <option value="15">15 minutes</option>
            <option value="20">20 minutes</option>
            <option value="30">30 minutes</option>
        </select>
        <button id="setTime">Set</button> <button id="resetTime" hidden>Reset</button>
    </div>
</body>

</html>